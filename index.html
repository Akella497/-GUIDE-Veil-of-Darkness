<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Методичка для отыгрыша на проекте "Вуаль Тьмы" by Akella</title>
  <link rel="icon" type="image/png" href="https://i.postimg.cc/XJSk855s/123.png">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="logo" aria-hidden>
      <svg viewBox="0 0 24 24" width="38" height="38" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2v20M2 12h20" stroke="#c9a86b" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </div>
    <div>
      <h1>Методичка для отыгрыша на проекте "Вуаль Тьмы"</h1>
      <p>Ниже находится кнопка, открывающая удобный функционал для учёта НИП на событиях.</p>
    </div>
  </header>

  <main>
    <!-- Page 1: Grimoire / info -->
    <div class="text">
      <section id="page-home" class="page active">
        <div class="info-wrap">
          <div class="top-actions">
            <button class="btn" id="go-npc">Для событий Искрильщиков</button>
          </div>
          <h2>Правила и заметки</h2>
          <hr style="border:none;height:1px;background:linear-gradient(90deg,transparent,var(--accent),transparent);margin:12px 0">
          <h2>Характеристики</h2>
      <p><span style="color: yellow;">Телосложение:</span> сочетание грубой силы и выносливости. Повреждение телосложения — это урон.</p>
      <p><span style="color: yellow;">Ловкость:</span> координация движений и моторика тела. Повреждение ловкости — это усталость.</p>
      <p><span style="color: yellow;">Смекалка:</span> интеллект, внимание и изобретательность. Повреждение смекалки — это смятение.</p>
      <p><span style="color: yellow">Эмпатия:</span> харизма, привлекательность и умение манипулировать окружающими. Повреждение эмпатии — это стресс.</p>
          <hr style="border:none;height:1px;background:linear-gradient(90deg,transparent,var(--accent),transparent);margin:12px 0">
          <h2>Броски</h2>
      <p><span style="color: yellow">Рискованный бросок</span> — это нажатие кнопки «Push» в тех ситуациях, когда Вам кажется, что Ваш результат является неудачным (например, нет 6 при совершении действия, то есть нет «успеха»). Однако, некоторые значения остаются вместе с Вами даже после совершения рискованного броска. Помните, что каждая 1 при броске — это урон, который получает Ваш персонаж при попытке совершить действие.</p>
      <p><span class="text-align: center;">При совершении рискованного броска..</span>
          <br>Поле «Характеристики» - здесь с Вами остаются и 6, и 1.
          <br>Навыки - только 6.
          <br>Снаряжение - остаются и 6, и 1.
          </p>
        </p>
      <p>То есть выгоднее всего, чтобы персонаж обладал вкачанным навыком, так как там есть шанс перебросить 1 («неуспехи»)</p>
      <hr style="border:none;height:1px;background:linear-gradient(90deg,transparent,var(--accent),transparent);margin:12px 0">
      <h2>Снаряжение</h2>
      <p>Существует три типа снаряжения: оружие, доспехи и вспомогательные.
      <br>У каждого снаряжения есть прочность, а у боевоего снаряжения - ещё и урон.</p>
      <p><span style="color:yellow">Оружие</span> — при совершении атаки с помощью "/ролл" Вам необходимо выбрать оружие с помощью строки "weapon". Количество дополнительных кубов предопределяется показателем прочности.</p>
      <p>Например, у Вашего персонажа есть пистолет (2 прочности и 2 урона). Ловкость у Вашего персонажа равна 5, навыки стрельбы — 3, а прочность пистолета — 2. Итого: 10 кубов при броске.</p>
      <p>Урон расчитывается следующим образом: первая шестерка — показатель урона в абсолютном объеме (то есть в нашем случае это 2 ед. урона), все последующие успехи — прибавляют 1 ед. урона.</p>
      <p>Например: за персонажа Вы совершаете стрельбу (10 кубиков, а именно 5+3+2, где 5 - ловкость, 3 - навыки стрельбы и 2 - пистолет), и Вам выпадают следующие значения: 1 4 5 <span style="color: green">6</span> 3 2 <span style="color: green">6</span> 4 8 <span style="color: green">6</span>. Это 4 урона.</p>
      <br>
      <br>
      <p><span style="color: yellow">Доспехи</span> — это Ваша защита. Некоторую часть урона может поглотить доспех (она же «броня»). Количество кубов прочности предопределяет количество кубов, которые будут проброшены Вами для «погашения» урона.</p>
      <p>Например: в Вашего персонажа стреляют из пистолета. Вы носите с собой сыромятную броню (её прочность - 4). Противник наносит 4 единицы урона. Вы применяете в чате команду "/roll myz gear: 4" и смотрите на значения. Допустим, Вам выпали следующие значения: <span style="color:red">1</span> 2 <span style="color: green">6</span> 5.</p>
      <p>Итак. В выпавших значениях есть одна <span style="color: red;">1 (неуспех)</span> и одна <span style="color: green;">6 (успех)</span>. <p>[х] Из-за одного неуспеха Вы потеряете 1 единицу качества брони. Потому что Ваш доспех не поглотил весь урон, нанесенный оппонентом. Если бы он поглотил весь урон, то выпавшая единица никак бы не сказалась качестве доспеха.<br><br>[x] Из-за одного успеха Вы поглощаете 1 единицу урона из 4 единиц урона, нанесенных Вам противником. <br>Оставшиеся 3 единицы урона бьют по Вашей характеристике «Телосложение».
      <br>
      <br>
         <p><span style="color: yellow">Вспомогательное снаряжение</span> — служит для увеличения шанса вероятности успеха. Так, одни предметы могут давать бонус к влиянию, а другие и к иным навыкам. Дабы система учитывала их наличие, их название нужно прописывать в разделе "weapon" при применении команды "/ролл".
      </p>
      <hr style="border:none;height:1px;background:linear-gradient(90deg,transparent,var(--accent),transparent);margin:12px 0">
      <h2>Дистанция и перемещение</h2>
      <p>В сражении расстояние между персонажем и его противниками можно условно разделить на пять ступеней:</p>
      <p><span class="green">Нулевая дистанция:</span> в непосредственной близости.<br>
      <span class="green">Ближняя дистанция:</span> до нескольких метров.<br>
      <span class="red">Средняя дистанция:</span> до пары десятков метров.<br>
      <span class="red">Дальняя дистанция:</span> до нескольких сотен метров.<br>
      <span class="red">Предельная дистанция:</span> в пределах видимости.</p>
      <p>Перемещение во время сражения считается манёвром.</p>
      <p><span class="green">Перемещение на одну ступень от нулевой до средней дистанции (включительно) требует ОДНОГО манёвра</span>
      <br>
      <span class="red">Перемещение на одну ступень от средней дистанции до предельной дистанции требует ДВУХ манёвров.</p></span>
      <p>Помните, что, предприняв за ход два манёвра, персонаж уже не сможет совершить действие.</p>
      <br>
      
      <p style="text-align: center;"><span style="color: yellow;">Полноценный ход = действие + маневр & маневр + маневр.</span></p>
      <p>Когда наступает ваш ход, вы можете предпринять либо <em>одно действие и один манёвр</em>, либо <em>два манёвра</em>. Персонаж совершает действие, когда:</p>
      <ul>
      <li>Проходит проверку любого навыка</li>
      <li>Оказывает помощь или помеху</li>
      </ul>
      <p>Персонаж совершает манёвр, когда:</p>
      <ul>
      <li>Перемещается на одну ступень дистанции</li>
      <li>Прячется в укрытие</li>
      <li>Достает предмет из рюкзака, сумки, или кармана</li>
      <li>Подбирает лежащий на земле предмет</li>
      <li>Готовит оружие к бою</li>
      <li>Целится из дистанционного оружия</li>
      <li>Перезаряжает дистанционное оружие</li>
      <li>Использует предмет</li>
      <li>Замахивается: Персонаж замахивается, чтобы усилить удар. Проверка не требуется, но замах выполняется только <strong>тяжёлым</strong> оружием. Этот манёвр необходимо предпринить непосредственно перед ударом или уколом (в том же раунде). Если атака будет успешной, урон увеличивается на 1</li>
      </ul>
      <h2>Модификаторы при стрельбе</h2>
      <hr style="border:none;height:1px;background:linear-gradient(90deg,transparent,var(--accent),transparent);margin:12px 0">
      <p><strong>Дистанции (вычитаем при стрельбе из огнестрельного оружия, расстояние отрицательно сказывается на точности стреляющего):</strong></p>
      <p>Средняя → –1<br>
      Дальняя → –2<br>
      Нулевая → –3 (не действует, если цель не замечает стрелка)
      <br>
      <br>
      <p><strong>Прицеливание (положительно влияет на точность стрельбы, однако требует потратить маневр):</strong>
        <p>С упором/укрытием (не для лука/пращи) → +2.<br>
        Обычное → +1<br></p>
        </p>Данные модификаторы действуют только в том же раунде, когда и были применены.</p>
      <br>
        <p><strong>Укрытие — стреляющий в персонажа, который находится в укрытии, совершает выстрел со штрафом -3; укрывающийся персонаж тратит маневр на то, чтобы занять позицию.</strong></p>
        <hr style="border:none;height:1px;background:linear-gradient(90deg,transparent,var(--accent),transparent);margin:12px 0">
        <h2>Прочие модификаторы</h2>
      <p><strong>Внезапная атака.</strong></p>
      <p>Если, по мнению мастера, персонаж застаёт врага врасплох, то в первом раунде сражения он получает +2 куба инициативы.<br>
      Кстати об инициативе, перед началом боя необходимо бросить кубик 5d6, дабы знать, как скоро вы сможете атаковать своего противника. Если Вы атакуете внезапно, то Вы бросаете 7d6 (это с учётом +2 к инициативе, как и было сказано ранее).</p>
      <br>
      <p><strong>Атака исподтишка</strong>.</p>
      <p>Осуществляется проверка Вашей скрытности против наблюдательности врага (одна проверка, независимо от дистанции).<br>
      В случае провала цель замечает Вашего персонажа, и начинается бой по стандартным правилам: все бросают инициативу (куб 5d6) и атакуют в порядке своей очереди.<br>
      В случае успеха персонаж подходит и получает одно <strong>бесплатное действие</strong> до инициативы.<br>
      <p><strong>При совместной атаке все проходят проверку. Провал одного раскрывает всех.</strong></p>
      <br>
      <p><strong>Засада:</strong></p>
      <p>Это особый вид атаки, подразумевающий, что персонажи ждут врага на месте.<br>
      Каждый проходит проверку скрытности <strong>отдельно</strong>.</p>
      
      <p>Все получают +2 к скрытности, так как враг движется к Вам, а Вы его поджидаете.</p>
       
      </div>
    </div>
    </section>

    <!-- Page 2: NPC creator -->
    <section id="page-npc" class="page">
      <div class="creator-wrap">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>Каталог NPC</h2>
          <div>
            <button class="btn secondary" id="back-home">Назад</button>
            <button class="btn" id="addNpcBtn">+ Добавить NPC</button>
          </div>
        </div>

        <p>Здесь можно добавлять и редактировать карточки NPC. Данные сохраняются в localStorage.</p>

        <div id="npc-list"></div>
      </div>
    </section>
  </main>

  <script>
    // Page switching
    const pageHome = document.getElementById('page-home');
    const pageNpc = document.getElementById('page-npc');
    document.getElementById('go-npc').addEventListener('click', ()=>{ pageHome.classList.remove('active'); pageNpc.classList.add('active'); });
    document.getElementById('back-home').addEventListener('click', ()=>{ pageNpc.classList.remove('active'); pageHome.classList.add('active'); });

    // NPC logic (same robust code as before)
    const npcList = document.getElementById('npc-list');
    const addBtn = document.getElementById('addNpcBtn');

    const fields = ["NPC","Телосложение","Ловкость","Смекалка","Эмпатия","Оружие","Доспехи","Таланты"];

    function createNpcCard(data = {}) {
      const card = document.createElement('div');
      card.className = 'npc-card';

fields.forEach((field, index) => {
  const row = document.createElement('div');
  row.className = 'npc-row';

  const label = document.createElement('label');
  label.textContent = field + ':';

  let input;
  if (field === 'Таланты' || field === 'Оружие' || field === 'Доспехи') {
    input = document.createElement('textarea');
    input.rows = 1;
    input.style.overflow = 'hidden';
    input.style.resize = 'none';
    input.addEventListener('input', () => {
      input.style.height = 'auto';
      input.style.height = input.scrollHeight + 'px';
      saveAll();
    });
  } else {
    input = document.createElement('input');
    input.type = 'text';
    input.addEventListener('input', saveAll);
  }

  if (index === 0) { input.style.color = 'orange'; input.style.fontWeight = 'bold'; }
  if (data[field] !== undefined) input.value = data[field];

  row.appendChild(label);
  row.appendChild(input);

  // Добавляем кнопки +1 / -1
  const modifiable = ["Телосложение", "Ловкость", "Смекалка", "Эмпатия"];
  if (modifiable.includes(field)) {
      const minusBtn = document.createElement('button');
      minusBtn.textContent = '-1';
      minusBtn.className = 'stat-btn';
      minusBtn.onclick = () => {
          const val = parseInt(input.value || 0, 10);
          input.value = val - 1;
          saveAll();
      };

      const plusBtn = document.createElement('button');
      plusBtn.textContent = '+1';
      plusBtn.className = 'stat-btn';
      plusBtn.onclick = () => {
          const val = parseInt(input.value || 0, 10);
          input.value = val + 1;
          saveAll();
      };

      row.appendChild(minusBtn);
      row.appendChild(plusBtn);
  }

  card.appendChild(row);
});

      const controls = document.createElement('div');
      controls.className = 'npc-controls';

      const copyBtn = document.createElement('button'); copyBtn.textContent = 'Скопировать';
      copyBtn.onclick = () => {
        const dataLines = [];
        card.querySelectorAll('.npc-row').forEach(row => {
          const label = row.querySelector('label').textContent.replace(':','');
          const inputEl = row.querySelector('input, textarea');
          dataLines.push(label + ': ' + (inputEl.value || ''));
        });
        navigator.clipboard.writeText(dataLines.join('\n'))
          .then(()=>{ copyBtn.textContent = '✓'; setTimeout(()=>copyBtn.textContent='Скопировать',800); })
          .catch(()=>{ copyBtn.textContent = 'Ошибка'; setTimeout(()=>copyBtn.textContent='Скопировать',1000); });
      };

      const delBtn = document.createElement('button'); delBtn.textContent = 'Удалить';
      delBtn.onclick = () => { if (confirm('Удалить эту карточку NPC?')){ card.remove(); saveAll(); } };

      controls.appendChild(copyBtn); controls.appendChild(delBtn);
      card.appendChild(controls);

      return card;
    }

    function loadAll(){
      const raw = localStorage.getItem('grimoire_npcs_v1');
      npcList.innerHTML = '';
      if (raw){
        try{
          const arr = JSON.parse(raw);
          if (Array.isArray(arr) && arr.length){
            arr.forEach(item=> npcList.appendChild(createNpcCard(item)) );
            return;
          }
        }catch(e){ console.warn('parse error',e); }
      }
      npcList.appendChild(createNpcCard());
      npcList.appendChild(createNpcCard());
    }

    function saveAll(){
      const cards = [];
      npcList.querySelectorAll('.npc-card').forEach(c=>{
        const item = {};
        c.querySelectorAll('.npc-row').forEach((r)=>{
          const key = r.querySelector('label').textContent.replace(':','');
          const val = (r.querySelector('input, textarea')||{value:''}).value;
          item[key] = val;
        });
        cards.push(item);
      });
      try{ localStorage.setItem('grimoire_npcs_v1', JSON.stringify(cards)); }catch(e){ console.warn('save failed',e); }
    }

    // init
    loadAll();
    addBtn.addEventListener('click', ()=>{ npcList.appendChild(createNpcCard()); saveAll(); const last = npcList.lastChild; const firstInput = last.querySelector('input'); if (firstInput) firstInput.focus(); });

    // expose for debug
    window._grimoire_save = saveAll; window._grimoire_load = loadAll;
  </script>
</body>




